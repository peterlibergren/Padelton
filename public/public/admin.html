<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <title>Padelton Admin – Spillernavne</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, sans-serif;
      background: #020617;
      color: #e5e7eb;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      text-align: center;
      padding: 10px 8px;
    }

    h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .subtitle {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-top: 4px;
    }

    main {
      width: 100%;
      max-width: 700px;
      padding: 8px;
      box-sizing: border-box;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      background: #020617;
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      padding: 6px 8px;
      font-size: 0.9rem;
    }

    th {
      text-align: left;
      background: #0f172a;
      border-bottom: 1px solid #1f2937;
    }

    tr:nth-child(even) td {
      background: rgba(15, 23, 42, 0.7);
    }

    tr:nth-child(odd) td {
      background: rgba(15, 23, 42, 0.9);
    }

    input {
      width: 100%;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
      box-sizing: border-box;
    }

    input:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }

    button {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #38bdf8;
      background: #0f172a;
      color: #e5e7eb;
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
    }

    button:hover {
      background: #0b1120;
    }

    .status-cell {
      font-size: 0.75rem;
      color: #9ca3af;
      min-width: 80px;
    }

    .status-ok {
      color: #22c55e;
    }

    .status-error {
      color: #f97373;
    }

    .top-links {
      margin-top: 4px;
      font-size: 0.8rem;
    }

    .top-links a {
      color: #38bdf8;
      text-decoration: none;
      margin: 0 4px;
    }

    .top-links a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      th:nth-child(4),
      td:nth-child(4) {
        display: none; /* skjul status-kolonne på meget smal mobil */
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>PADELTON ADMIN</h1>
    <div class="subtitle">Spillernavne pr. bane</div>
    <div class="top-links">
      <a href="/view.html" target="_blank">Åbn public view</a> •
      <a href="/" target="_blank">Åbn hoved-scoreboard</a>
    </div>
  </header>

  <main>
    <table>
      <thead>
        <tr>
          <th>Bane</th>
          <th>Hjemmehold</th>
          <th>Udehold</th>
          <th>Status</th>
          <th>Gem</th>
        </tr>
      </thead>
      <tbody id="courtsBody">
        <!-- Rækker genereres via JS -->
      </tbody>
    </table>
  </main>

  <script>
    const courts = [
      { id: 2, sponsor: "Bane 2 – Brdr. Thybo" },
      { id: 3, sponsor: "Bane 3 – Schantz" },
      { id: 1, sponsor: "Bane 1 – BetaPack" },
      { id: 4, sponsor: "Bane 4 – 10-4" },
      { id: 5, sponsor: "Bane 5 – Slagteren" },
    ];

    const tbody = document.getElementById("courtsBody");

    // Lav rækker
    courts.forEach(court => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${court.sponsor}</td>
        <td>
          <input type="text" id="homeName-${court.id}" placeholder="Hjemmehold" />
        </td>
        <td>
          <input type="text" id="awayName-${court.id}" placeholder="Udehold" />
        </td>
        <td class="status-cell">
          <span id="status-${court.id}"></span>
        </td>
        <td>
          <button type="button" onclick="saveCourt(${court.id})">Gem</button>
        </td>
      `;
      tbody.appendChild(tr);
    });

    async function loadCurrentNames() {
      try {
        const resp = await fetch("/api/courts", { cache: "no-store" });
        if (!resp.ok) throw new Error("HTTP " + resp.status);

        const data = await resp.json();
        data.forEach(c => {
          const id = c.courtId;
          const homeInput = document.getElementById(`homeName-${id}`);
          const awayInput = document.getElementById(`awayName-${id}`);
          if (!homeInput || !awayInput) return;

          homeInput.value = c.homeName || "";
          awayInput.value = c.awayName || "";
        });
      } catch (err) {
        console.error("Kunne ikke hente nuværende navne:", err);
      }
    }

    async function saveCourt(id) {
      const homeInput = document.getElementById(`homeName-${id}`);
      const awayInput = document.getElementById(`awayName-${id}`);
      const statusSpan = document.getElementById(`status-${id}`);

      if (!homeInput || !awayInput || !statusSpan) return;

      const homeName = homeInput.value.trim();
      const awayName = awayInput.value.trim();

      statusSpan.textContent = "Gemmer...";
      statusSpan.className = "status-cell";

      try {
        const resp = await fetch("/api/setNames", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            courtId: id,
            homeName,
            awayName,
          }),
        });

        if (!resp.ok) {
          throw new Error("HTTP " + resp.status);
        }

        const data = await resp.json();
        statusSpan.textContent = "Gemt";
        statusSpan.className = "status-cell status-ok";
      } catch (err) {
        console.error("Fejl ved gem for bane", id, err);
        statusSpan.textContent = "Fejl";
        statusSpan.className = "status-cell status-error";
      }

      setTimeout(() => {
        statusSpan.textContent = "";
        statusSpan.className = "status-cell";
      }, 3000);
    }

    // Hent nuværende navne ved load
    loadCurrentNames();
  </script>
</body>
</html>
